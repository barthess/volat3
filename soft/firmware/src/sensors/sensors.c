#include "ch.h"
#include "hal.h"

#include "sensors.h"
#include "message.h"

#include "adc_local.h"
#include "exti_local.h"
#include "tmp75.h"
#include "lis3.h"
#include "discrete.h"

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */
RawData raw_data;                     /* структура с сырыми данными с датчиков */
CompensatedData comp_data;            /* обработанные данные */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/* примитивы для синхронизации потока с прерываниеми от датчиков */
static BinarySemaphore lis3_sem;

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 *******************************************************************************
 *******************************************************************************
 * LOCAL FUNCTIONS
 *******************************************************************************
 *******************************************************************************
 */

/*
 *******************************************************************************
 * EXPORTED FUNCTIONS
 *******************************************************************************
 */
void SensorsInit(void){

  /* инициализация семафоров */
  chBSemInit(&lis3_sem,  TRUE);

  /* Запуск контроллера внешних прерываний. */
  ExtiInitLocal();
  ADCInitLocal();
  DiscreteInitLocal();

  /* start I2C sensors */

  init_lis3();
  init_tmp75();
}

