#include <stdlib.h>

#include "ch.h"
#include "hal.h"


/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */
/**
 * @brief   Software debauncer function.
 *
 * @param[in] need    needed state of pin.
 * @param[in] state   current state of pin. Use palReadPad() to get it
 * @param[in] try     how many trys to perform
 * @param[in] t       time between trys
 *
 * @return TRUE       if need value decided to acqured
 *         FALSE      otherwize
 */
bool_t debounce(uint32_t need, uint32_t state, int32_t try, systime_t t){
  int32_t n = 0;

  while(abs(n) < try){
    chThdSleep(t);
    if (state != need)
      n--;
    else
      n++;
  }

  if (n > 0)
    return TRUE;
  else
    return FALSE;
}




